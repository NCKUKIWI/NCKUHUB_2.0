var course_db=[];axios.get("https://nckuhub.com/api/course/").then(function(t){console.log("axios: 抓取資料成功！"),course_db=t.data.courses,vue_user_data.checkValid(),vue_wishlist.refresh(),vue_classtable.refresh()}).catch(function(t){console.log("axios:"+t)}),Vue.component("result-list-item",{data:function(){return{}},props:["class_item"],template:['<div class="list_course_item"  @mouseover="mouseoverItem" @mouseout="mouseoutItem" >','<div class="list_course_item_left">','<p class="list_course_item_category text_20 text_white" :class="getClass()"> {{ class_item.category }} </p>',"</div>",'<div class="list_course_item_mid" @click="addToTable">','<p class="list_course_item_title text_16">{{ class_item.dept_id }}-{{ class_item.class_id }} {{ class_item.title }}</p>','<p class="list_course_item_description text_14 text_dark">{{ class_item.teacher }} — {{ class_item.time }}</p>',"</div>",'<div class="list_course_item_right" @click="addToTable">','<div class="list_course_item_button"></div>',"</div>","</div>"].join(""),methods:{getClass:function(){return this.class_item.dept_id},addToTable:function(){checkConflict(this.class_item,vue_classtable)&&(vue_user_data.tableAdd(this.class_item.id),vue_classtable.clearFilterCell())},mouseoverItem:function(){checkConflict(this.class_item,vue_classtable)&&vue_classtable.refresh(this.class_item.id)},mouseoutItem:function(){vue_classtable.refresh()}}}),Vue.component("class-table-cell",{data:function(){return{}},props:["day","cell_data"],template:['<div class="class_table_cont_cell class_cell" :style="getHeight()" @click="startFilterTIme" :class="getClass()" >','<div class="class_table_cont_cell_button" @click="deleteItem"></div>','<p class="class_table_cont_cell_id text_12" :class="[{ previewing: cell_data.ifPreview }, { rush: cell_data.ifRush }]"> {{ cell_data.cell_status_title }} </p>','<p class="class_table_cont_cell_title text_16 text_bold"> {{ cell_data.cell_status_text }} </p>','<p v-if="cell_data.status > 1" class="class_table_cont_cell_description text_14 text_dark"> {{ cell_data.class_item.teacher }} </p>',"</div>"].join(""),created:function(){},methods:{getHeight:function(){var t="";return this.cell_data.status>0?t+="height: "+this.cell_data.status*(100/9)+"%":this.cell_data.status<0&&(t+="display: none"),t},getClass:function(){var t="";return this.cell_data.status>0&&(t+="occupied "),this.cell_data.ifFilterTime&&(t+="filtering "),this.cell_data.ifPreview&&(t+="previewing "),this.cell_data.ifRush&&(t+="rush "),t+=this.cell_data.class_item.dept_id},deleteItem:function(){this.cell_data.status>0&&(vue_user_data.wishlistAdd(this.cell_data.class_item.id),vue_user_data.tableRemove(this.cell_data.class_item.id))},startFilterTIme:function(){0!=this.cell_data.status||vue_classtable.class_table_locked||(vue_classtable.markFilterCell(this.day,this.cell_data.time)?(vue_wishlist.clearFilter(),vue_wishlist.filterItemTIme(this.day,this.cell_data.time)):vue_wishlist.clearFilter())}}});var vue_quick_search=new Vue({el:"#quick_search",data:{keyword:"",result_cont:[],filter_status:!1,title_text:"快速添加",class_table_locked:!0},computed:{result:function(){if(this.result_cont.length=0,this.keyword)for(var t=0;t<course_db.length;t++)if(course_db[t].課程名稱.match(this.keyword)||course_db[t].老師.match(this.keyword)){var e=getClassObject(course_db,course_db[t].id);getTimeObject(e)&&this.result_cont.push(e)}}},methods:{filterMode:function(t,e,l){"on"==t?(this.keyword="正在篩選：["+textTransDay(e)+"]"+l,this.filter_status=!0,this.title_text="篩選時段"):"off"==t&&(this.keyword="",this.filter_status=!1,this.title_text="快速添加")},clearFilter:function(){this.filter_status&&(this.filterMode("off"),vue_classtable.clearFilterCell(),vue_wishlist.clearFilter())},switchLockStatus:function(){this.class_table_locked=!this.class_table_locked}}}),vue_classtable=new Vue({el:"#class_table",data:{monday:[],tuesday:[],wednesday:[],thursday:[],friday:[],filtering_now:{day:null,time:null},class_table_locked:!0},methods:{toTable:function(t,e,l){var s=getClassObject(e,t),i=getTimeObject(s);if(checkConflict(s,this)){for(var a,c,_,r=0;r<i.length;r++){a=i[r].day,c=i[r].start,_=i[r].hrs;for(var o=0;o<_;o++){fill_cell=this[a].find(function(t){return t.time==c}),fill_cell.status=_,fill_cell.class_item=s,fill_cell.cell_status_title=fill_cell.class_item.dept_id+"-"+fill_cell.class_item.class_id,fill_cell.cell_status_text=fill_cell.class_item.title,l&&(fill_cell.ifPreview=!0);for(var u=1;u<_;u++)fill_cell=this[a].find(function(t){return t.time==timeTransText(textTransTime(c)+u)}),fill_cell.status=-1,fill_cell.cell_status_title=null,fill_cell.cell_status_text=null}}return 1}return 0},refresh:function(t){for(var e,l,s,i="目前課表課程：",a=0;a<vue_user_data.now_table.length;a++)i+=vue_user_data.now_table[a]+" ";console.log(i);for(a=1;a<=5;a++){this[e=dayTransText(a)].length=0;for(var c=1;c<=15;c++)l=timeTransText(c).toString(),this[e].push({time:l,status:0,class_item:"",ifFilterTime:!1,cell_status_title:"篩選課程",cell_status_text:"選擇此時段"})}for(a=0;a<vue_user_data.now_table.length;a++)s=vue_user_data.now_table[a],this.toTable(s,course_db);t&&this.toTable(t,course_db,!0),this.filtering_now.day&&this.filtering_now.time&&this.markFilterCell(this.filtering_now.day,this.filtering_now.time)},markFilterCell:function(t,e){var l=this[t].find(function(t){return t.time==e});return l.ifFilterTime?(this.clearFilterCell(),vue_quick_search.filterMode("off"),0):(this.clearFilterCell(),l.ifFilterTime=!0,this.filtering_now.day=t,this.filtering_now.time=e,vue_quick_search.filterMode("on",t,e),1)},clearFilterCell:function(){for(var t,e,l=1;l<=5;l++){t=dayTransText(l);for(var s=1;s<=15;s++)e=timeTransText(s).toString(),this[t].find(function(t){return t.time==e}).ifFilterTime=!1}this.filtering_now.day=null,this.filtering_now.time=null,vue_quick_search.keyword=null},switchLockStatus:function(){this.class_table_locked=!this.class_table_locked}}}),vue_fixed_button=new Vue({el:"#fixed_button",data:{class_table_locked:!0},methods:{switchLockStatus:function(){this.class_table_locked=!this.class_table_locked,vue_wishlist.switchLockStatus(),vue_quick_search.switchLockStatus(),vue_classtable.switchLockStatus(),1==this.class_table_locked?window.onbeforeunload=null:window.onbeforeunload=function(t){t.returnValue=!1}}}});