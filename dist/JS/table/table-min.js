var course_db=[];axios.get("https://nckuhub.com/test/course/").then(function(t){console.log("axios: 抓取資料成功！"),course_db=t.data.courses,vue_user_data.checkValid(),vue_wishlist.refresh(),vue_classtable.refresh()}).catch(function(t){console.log("axios:"+t)});var user_data={user_name:"林耿弘",user_photo:"dist/images/profile.png",credit_count:9,now_wishlist:[43081,4021,43021,42973,42971,42969,42968],now_table:[43084,4021,43023,43020]};Vue.component("wishlist-item",{data:function(){return{hover_now:!1}},props:["class_item"],template:['<div v-if="class_item.isSeen" class="list_course_item" @mouseover="mouseoverItem" @mouseout="mouseoutItem" >','<div class="list_course_item_left">','<p class="list_course_item_category text_20 text_white clickable" @click="deleteItem" :class="getClass()"> {{ class_item.category }} </p>',"</div>",'<div class="list_course_item_mid" @click="addToTable">','<p class="list_course_item_title text_16">{{ class_item.dept_id }}-{{ class_item.class_id }} {{ class_item.title }}</p>','<p class="list_course_item_description text_14 text_dark">{{ class_item.teacher }} — {{ class_item.time }}</p>',"</div>",'<div class="list_course_item_right" @click="addToTable">','<div class="list_course_item_button"></div>',"</div>","</div>"].join(""),methods:{getClass:function(){return this.class_item.dept_id},addToTable:function(){checkConflict(this.class_item,vue_classtable)&&(vue_user_data.tableAdd(this.class_item.id),vue_user_data.wishlistRemove(this.class_item.id),vue_classtable.clearFilterCell())},deleteItem:function(){console.log("wishlist killed: "+vue_wishlist.wishlist_cont.indexOf(this.class_item)+" ("+this.class_item.title+")"),vue_user_data.wishlistRemove(this.class_item.id)},mouseoverItem:function(){checkConflict(this.class_item,vue_classtable)&&vue_classtable.refresh(this.class_item.id)},mouseoutItem:function(){vue_classtable.refresh()}}}),Vue.component("result-list-item",{data:function(){return{}},props:["class_item"],template:['<div class="list_course_item"  @mouseover="mouseoverItem" @mouseout="mouseoutItem" >','<div class="list_course_item_left">','<p class="list_course_item_category text_20 text_white" :class="getClass()"> {{ class_item.category }} </p>',"</div>",'<div class="list_course_item_mid" @click="addToTable">','<p class="list_course_item_title text_16">{{ class_item.dept_id }}-{{ class_item.class_id }} {{ class_item.title }}</p>','<p class="list_course_item_description text_14 text_dark">{{ class_item.teacher }} — {{ class_item.time }}</p>',"</div>",'<div class="list_course_item_right" @click="addToTable">','<div class="list_course_item_button"></div>',"</div>","</div>"].join(""),methods:{getClass:function(){return this.class_item.dept_id},addToTable:function(){checkConflict(this.class_item,vue_classtable)&&(vue_user_data.tableAdd(this.class_item.id),vue_classtable.clearFilterCell())},mouseoverItem:function(){checkConflict(this.class_item,vue_classtable)&&vue_classtable.refresh(this.class_item.id)},mouseoutItem:function(){vue_classtable.refresh()}}}),Vue.component("class-table-cell",{data:function(){return{}},props:["day","cell_data"],template:['<div class="class_table_cont_cell class_cell" :style="getHeight()" @click="startFilterTIme" :class="getClass()" >','<div class="class_table_cont_cell_button" @click="deleteItem"></div>','<p class="class_table_cont_cell_id text_12" :class="[{ previewing: cell_data.ifPreview }, { rush: cell_data.ifRush }]"> {{ cell_data.cell_status_title }} </p>','<p class="class_table_cont_cell_title text_16 text_bold"> {{ cell_data.cell_status_text }} </p>','<p v-if="cell_data.status > 1" class="class_table_cont_cell_description text_14 text_dark"> {{ cell_data.class_item.teacher }} </p>',"</div>"].join(""),created:function(){},methods:{getHeight:function(){var t="";return this.cell_data.status>0?t+="height: "+this.cell_data.status*(100/9)+"%":this.cell_data.status<0&&(t+="display: none"),t},getClass:function(){var t="";return this.cell_data.status>0&&(t+="occupied "),this.cell_data.ifFilterTime&&(t+="filtering "),this.cell_data.ifPreview&&(t+="previewing "),this.cell_data.ifRush&&(t+="rush "),t+=this.cell_data.class_item.dept_id},deleteItem:function(){this.cell_data.status>0&&(vue_user_data.wishlistAdd(this.cell_data.class_item.id),vue_user_data.tableRemove(this.cell_data.class_item.id))},startFilterTIme:function(){0!=this.cell_data.status||vue_classtable.class_table_locked||(vue_classtable.markFilterCell(this.day,this.cell_data.time)?(vue_wishlist.clearFilter(),vue_wishlist.filterItemTIme(this.day,this.cell_data.time)):vue_wishlist.clearFilter())}}});var vue_user_data=new Vue({el:"#user_data",data:user_data,methods:{checkValid:function(){for(var t=0;t<this.now_wishlist.length;t++)getClassObject(course_db,vue_user_data.now_wishlist[t])||this.now_wishlist.splice(t,1);for(t=0;t<this.now_table.length;t++)getClassObject(course_db,vue_user_data.now_table[t])||this.now_table.splice(t,1)},wishlistAdd:function(t){this.now_wishlist.push(t),vue_wishlist.refresh()},wishlistRemove:function(t){var e=this.now_wishlist.indexOf(t);console.log("kill wishlist: "+e),this.now_wishlist.splice(e,1),vue_wishlist.wishlist_cont.splice(e,1)},tableAdd:function(t){this.now_table.push(t),console.log(t),vue_classtable.refresh()},tableRemove:function(t){var e=vue_user_data.now_table.indexOf(t);vue_user_data.now_table.splice(e,1),vue_classtable.refresh()}}}),vue_quick_search=new Vue({el:"#quick_search",data:{keyword:"",result_cont:[],filter_status:!1,title_text:"快速添加",class_table_locked:!0},computed:{result:function(){if(this.result_cont.length=0,this.keyword)for(var t=0;t<course_db.length;t++)if(course_db[t].課程名稱.match(this.keyword)||course_db[t].老師.match(this.keyword)){var e=getClassObject(course_db,course_db[t].id);getTimeObject(e)&&this.result_cont.push(e)}}},methods:{filterMode:function(t,e,s){"on"==t?(this.keyword="正在篩選：["+textTransDay(e)+"]"+s,this.filter_status=!0,this.title_text="篩選時段"):"off"==t&&(this.keyword="",this.filter_status=!1,this.title_text="快速添加")},clearFilter:function(){this.filter_status&&(this.filterMode("off"),vue_classtable.clearFilterCell(),vue_wishlist.clearFilter())},switchLockStatus:function(){this.class_table_locked=!this.class_table_locked}}}),vue_wishlist=new Vue({el:"#wishlist",data:{wishlist_cont:[],class_table_locked:!0},methods:{refresh:function(){this.wishlist_cont.length=0;for(var t=0;t<vue_user_data.now_wishlist.length;t++){var e=getClassObject(course_db,vue_user_data.now_wishlist[t]);e.isSeen=!0,this.wishlist_cont.push(e)}this.clearFilter()},clearFilter:function(){for(var t=0;t<this.wishlist_cont.length;t++)this.wishlist_cont[t].isSeen=!0},filterItemTIme:function(t,e){e=textTransTime(e);for(var s=0;s<this.wishlist_cont.length;s++){var l=getTimeObject(this.wishlist_cont[s])[0].day,i=getTimeObject(this.wishlist_cont[s])[0].start;i=textTransTime(i);var a=parseInt(i)+getTimeObject(this.wishlist_cont[s])[0].hrs-1;t==l&&e>=i&&e<=a||(this.wishlist_cont[s].isSeen=!1)}},switchLockStatus:function(){this.class_table_locked=!this.class_table_locked}}}),vue_classtable=new Vue({el:"#class_table",data:{monday:[],tuesday:[],wednesday:[],thursday:[],friday:[],filtering_now:{day:null,time:null},class_table_locked:!0},methods:{toTable:function(t,e,s){var l=getClassObject(e,t),i=getTimeObject(l);if(checkConflict(l,this)){for(var a,c,_,o=0;o<i.length;o++){a=i[o].day,c=i[o].start,_=i[o].hrs;for(var r=0;r<_;r++){fill_cell=this[a].find(function(t){return t.time==c}),fill_cell.status=_,fill_cell.class_item=l,fill_cell.cell_status_title=fill_cell.class_item.dept_id+"-"+fill_cell.class_item.class_id,fill_cell.cell_status_text=fill_cell.class_item.title,s&&(fill_cell.ifPreview=!0);for(var u=1;u<_;u++)fill_cell=this[a].find(function(t){return t.time==timeTransText(textTransTime(c)+u)}),fill_cell.status=-1,fill_cell.cell_status_title=null,fill_cell.cell_status_text=null}}return 1}return 0},refresh:function(t){for(var e,s,l,i="目前課表課程：",a=0;a<vue_user_data.now_table.length;a++)i+=vue_user_data.now_table[a]+" ";console.log(i);for(a=1;a<=5;a++){this[e=dayTransText(a)].length=0;for(var c=1;c<=15;c++)s=timeTransText(c).toString(),this[e].push({time:s,status:0,class_item:"",ifFilterTime:!1,cell_status_title:"篩選課程",cell_status_text:"選擇此時段"})}for(a=0;a<vue_user_data.now_table.length;a++)l=vue_user_data.now_table[a],this.toTable(l,course_db);t&&this.toTable(t,course_db,!0),this.filtering_now.day&&this.filtering_now.time&&this.markFilterCell(this.filtering_now.day,this.filtering_now.time)},markFilterCell:function(t,e){var s=this[t].find(function(t){return t.time==e});return s.ifFilterTime?(this.clearFilterCell(),vue_quick_search.filterMode("off"),0):(this.clearFilterCell(),s.ifFilterTime=!0,this.filtering_now.day=t,this.filtering_now.time=e,vue_quick_search.filterMode("on",t,e),1)},clearFilterCell:function(){for(var t,e,s=1;s<=5;s++){t=dayTransText(s);for(var l=1;l<=15;l++)e=timeTransText(l).toString(),this[t].find(function(t){return t.time==e}).ifFilterTime=!1}this.filtering_now.day=null,this.filtering_now.time=null,vue_quick_search.keyword=null},switchLockStatus:function(){this.class_table_locked=!this.class_table_locked}}}),vue_fixed_button=new Vue({el:"#fixed_button",data:{class_table_locked:!0},methods:{switchLockStatus:function(){this.class_table_locked=!this.class_table_locked,vue_wishlist.switchLockStatus(),vue_quick_search.switchLockStatus(),vue_classtable.switchLockStatus(),1==this.class_table_locked?window.onbeforeunload=null:window.onbeforeunload=function(t){t.returnValue=!1}}}});